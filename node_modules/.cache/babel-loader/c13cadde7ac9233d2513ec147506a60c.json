{"ast":null,"code":"import { Matrix4 } from '../math/Matrix4.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector4 } from '../math/Vector4.js';\nimport { Frustum } from '../math/Frustum.js';\n\nfunction LightShadow(camera) {\n  this.camera = camera;\n  this.bias = 0;\n  this.normalBias = 0;\n  this.radius = 1;\n  this.mapSize = new Vector2(512, 512);\n  this.map = null;\n  this.mapPass = null;\n  this.matrix = new Matrix4();\n  this.autoUpdate = true;\n  this.needsUpdate = false;\n  this._frustum = new Frustum();\n  this._frameExtents = new Vector2(1, 1);\n  this._viewportCount = 1;\n  this._viewports = [new Vector4(0, 0, 1, 1)];\n}\n\nObject.assign(LightShadow.prototype, {\n  _projScreenMatrix: new Matrix4(),\n  _lightPositionWorld: new Vector3(),\n  _lookTarget: new Vector3(),\n  getViewportCount: function getViewportCount() {\n    return this._viewportCount;\n  },\n  getFrustum: function getFrustum() {\n    return this._frustum;\n  },\n  updateMatrices: function updateMatrices(light) {\n    var shadowCamera = this.camera,\n        shadowMatrix = this.matrix,\n        projScreenMatrix = this._projScreenMatrix,\n        lookTarget = this._lookTarget,\n        lightPositionWorld = this._lightPositionWorld;\n    lightPositionWorld.setFromMatrixPosition(light.matrixWorld);\n    shadowCamera.position.copy(lightPositionWorld);\n    lookTarget.setFromMatrixPosition(light.target.matrixWorld);\n    shadowCamera.lookAt(lookTarget);\n    shadowCamera.updateMatrixWorld();\n    projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\n\n    this._frustum.setFromProjectionMatrix(projScreenMatrix);\n\n    shadowMatrix.set(0.5, 0.0, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 1.0);\n    shadowMatrix.multiply(shadowCamera.projectionMatrix);\n    shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\n  },\n  getViewport: function getViewport(viewportIndex) {\n    return this._viewports[viewportIndex];\n  },\n  getFrameExtents: function getFrameExtents() {\n    return this._frameExtents;\n  },\n  copy: function copy(source) {\n    this.camera = source.camera.clone();\n    this.bias = source.bias;\n    this.radius = source.radius;\n    this.mapSize.copy(source.mapSize);\n    return this;\n  },\n  clone: function clone() {\n    return new this.constructor().copy(this);\n  },\n  toJSON: function toJSON() {\n    var object = {};\n    if (this.bias !== 0) object.bias = this.bias;\n    if (this.normalBias !== 0) object.normalBias = this.normalBias;\n    if (this.radius !== 1) object.radius = this.radius;\n    if (this.mapSize.x !== 512 || this.mapSize.y !== 512) object.mapSize = this.mapSize.toArray();\n    object.camera = this.camera.toJSON(false).object;\n    delete object.camera.matrix;\n    return object;\n  }\n});\nexport { LightShadow };","map":{"version":3,"sources":["/Users/sebringrose/Projects/theEmpire/website/client/node_modules/three/src/lights/LightShadow.js"],"names":["Matrix4","Vector2","Vector3","Vector4","Frustum","LightShadow","camera","bias","normalBias","radius","mapSize","map","mapPass","matrix","autoUpdate","needsUpdate","_frustum","_frameExtents","_viewportCount","_viewports","Object","assign","prototype","_projScreenMatrix","_lightPositionWorld","_lookTarget","getViewportCount","getFrustum","updateMatrices","light","shadowCamera","shadowMatrix","projScreenMatrix","lookTarget","lightPositionWorld","setFromMatrixPosition","matrixWorld","position","copy","target","lookAt","updateMatrixWorld","multiplyMatrices","projectionMatrix","matrixWorldInverse","setFromProjectionMatrix","set","multiply","getViewport","viewportIndex","getFrameExtents","source","clone","constructor","toJSON","object","x","y","toArray"],"mappings":"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","sourcesContent":["import { Matrix4 } from '../math/Matrix4.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector4 } from '../math/Vector4.js';\nimport { Frustum } from '../math/Frustum.js';\n\nfunction LightShadow( camera ) {\n\n\tthis.camera = camera;\n\n\tthis.bias = 0;\n\tthis.normalBias = 0;\n\tthis.radius = 1;\n\n\tthis.mapSize = new Vector2( 512, 512 );\n\n\tthis.map = null;\n\tthis.mapPass = null;\n\tthis.matrix = new Matrix4();\n\n\tthis.autoUpdate = true;\n\tthis.needsUpdate = false;\n\n\tthis._frustum = new Frustum();\n\tthis._frameExtents = new Vector2( 1, 1 );\n\n\tthis._viewportCount = 1;\n\n\tthis._viewports = [\n\n\t\tnew Vector4( 0, 0, 1, 1 )\n\n\t];\n\n}\n\nObject.assign( LightShadow.prototype, {\n\n\t_projScreenMatrix: new Matrix4(),\n\n\t_lightPositionWorld: new Vector3(),\n\n\t_lookTarget: new Vector3(),\n\n\tgetViewportCount: function () {\n\n\t\treturn this._viewportCount;\n\n\t},\n\n\tgetFrustum: function () {\n\n\t\treturn this._frustum;\n\n\t},\n\n\tupdateMatrices: function ( light ) {\n\n\t\tconst shadowCamera = this.camera,\n\t\t\tshadowMatrix = this.matrix,\n\t\t\tprojScreenMatrix = this._projScreenMatrix,\n\t\t\tlookTarget = this._lookTarget,\n\t\t\tlightPositionWorld = this._lightPositionWorld;\n\n\t\tlightPositionWorld.setFromMatrixPosition( light.matrixWorld );\n\t\tshadowCamera.position.copy( lightPositionWorld );\n\n\t\tlookTarget.setFromMatrixPosition( light.target.matrixWorld );\n\t\tshadowCamera.lookAt( lookTarget );\n\t\tshadowCamera.updateMatrixWorld();\n\n\t\tprojScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );\n\t\tthis._frustum.setFromProjectionMatrix( projScreenMatrix );\n\n\t\tshadowMatrix.set(\n\t\t\t0.5, 0.0, 0.0, 0.5,\n\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t0.0, 0.0, 0.0, 1.0\n\t\t);\n\n\t\tshadowMatrix.multiply( shadowCamera.projectionMatrix );\n\t\tshadowMatrix.multiply( shadowCamera.matrixWorldInverse );\n\n\t},\n\n\tgetViewport: function ( viewportIndex ) {\n\n\t\treturn this._viewports[ viewportIndex ];\n\n\t},\n\n\tgetFrameExtents: function () {\n\n\t\treturn this._frameExtents;\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.camera = source.camera.clone();\n\n\t\tthis.bias = source.bias;\n\t\tthis.radius = source.radius;\n\n\t\tthis.mapSize.copy( source.mapSize );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\ttoJSON: function () {\n\n\t\tconst object = {};\n\n\t\tif ( this.bias !== 0 ) object.bias = this.bias;\n\t\tif ( this.normalBias !== 0 ) object.normalBias = this.normalBias;\n\t\tif ( this.radius !== 1 ) object.radius = this.radius;\n\t\tif ( this.mapSize.x !== 512 || this.mapSize.y !== 512 ) object.mapSize = this.mapSize.toArray();\n\n\t\tobject.camera = this.camera.toJSON( false ).object;\n\t\tdelete object.camera.matrix;\n\n\t\treturn object;\n\n\t}\n\n} );\n\n\nexport { LightShadow };\n"]},"metadata":{},"sourceType":"module"}